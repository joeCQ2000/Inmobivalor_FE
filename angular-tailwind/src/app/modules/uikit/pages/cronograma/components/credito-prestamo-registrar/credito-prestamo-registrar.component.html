<div class="credito-form-container">
  <h2>Registrar Crédito</h2>

  @if (successMessage) {
    <div class="alert success">{{ successMessage }}</div>
  }

  @if (errorMessage) {
    <div class="alert error">{{ errorMessage }}</div>
  }

  <form [formGroup]="form" (ngSubmit)="submit()">
    <div class="form-grid">
      <!-- Entidad financiera -->
      <div class="form-field">
        <label>Entidad financiera</label>
        <select formControlName="id_entidad">
          <option [ngValue]="null">Seleccione...</option>
          @for (e of entidades; track e.id_entidad) {
            <option [ngValue]="e.id_entidad">{{ e.nombre }}</option>
          }
        </select>
        @if (controlInvalid('id_entidad')) {
          <small class="error-text">Seleccione una entidad.</small>
        }
      </div>

      <!-- Cliente -->
      <div class="form-field">
        <label>Cliente</label>
        <select formControlName="id_cliente">
          <option [ngValue]="null">Seleccione...</option>
          @for (c of clientes; track c.id_cliente) {
            <option [ngValue]="c.id_cliente">
              {{ c.nombres }} {{ c.apellidos }}
            </option>
          }
        </select>
        @if (controlInvalid('id_cliente')) {
          <small class="error-text">Seleccione un cliente.</small>
        }
      </div>

      <!-- Inmobiliaria -->
      <div class="form-field">
        <label>Inmobiliaria</label>
        <select formControlName="id_inmobiliaria">
          <option [ngValue]="null">Seleccione...</option>
          @for (i of inmobiliarias; track i.id_inmobiliaria) {
            <option [ngValue]="i.id_inmobiliaria">
              {{ i.ubicacion }} - {{ i.area }}
            </option>
          }
        </select>
        @if (controlInvalid('id_inmobiliaria')) {
          <small class="error-text">Seleccione una inmobiliaria.</small>
        }
      </div>

      <!-- Moneda -->
      <div class="form-field">
        <label>Moneda</label>
        <select formControlName="id_moneda">
          <option [ngValue]="null">Seleccione...</option>
          @for (m of monedas; track m.id_moneda) {
            <option [ngValue]="m.id_moneda">{{ m.tipo_moneda }}</option>
          }
        </select>
        @if (controlInvalid('id_moneda')) {
          <small class="error-text">Seleccione una moneda.</small>
        }
      </div>

      <!-- Plazo -->
      <div class="form-field">
        <label>Plazo (meses)</label>
        <input type="text" formControlName="plazo_meses" />
        @if (controlInvalid('plazo_meses')) {
          <small class="error-text">Ingrese el plazo en meses.</small>
        }
      </div>

      <!-- Tipo gracia -->
      <div class="form-field">
        <label>Tipo de gracia</label>
        <input type="text" formControlName="tipo_gracia" />
        @if (controlInvalid('tipo_gracia')) {
          <small class="error-text">Ingrese el tipo de gracia.</small>
        }
      </div>

      <!-- Monto bono -->
      <div class="form-field">
        <label>Monto bono</label>
        <input type="number" formControlName="monto_bono" />
        @if (controlInvalid('monto_bono')) {
          <small class="error-text">Ingrese un monto válido.</small>
        }
      </div>

      <!-- Meses gracia -->
      <div class="form-field">
        <label>Meses de gracia</label>
        <input type="number" formControlName="meses_gracia" />
        @if (controlInvalid('meses_gracia')) {
          <small class="error-text">Ingrese los meses de gracia.</small>
        }
      </div>

      <!-- Fecha inicio -->
      <div class="form-field">
        <label>Fecha inicio</label>
        <input type="date" formControlName="fecha_inicio" />
        @if (controlInvalid('fecha_inicio')) {
          <small class="error-text">Seleccione una fecha de inicio.</small>
        }
      </div>

      <!-- Fecha fin -->
      <div class="form-field">
        <label>Fecha fin</label>
        <input type="date" formControlName="fecha_fin" />
        @if (controlInvalid('fecha_fin')) {
          <small class="error-text">Seleccione una fecha de fin.</small>
        }
      </div>

      <!-- Capitalización -->
      <div class="form-field">
        <label>Capitalización</label>
        <input type="text" formControlName="capitalizacion" />
        @if (controlInvalid('capitalizacion')) {
          <small class="error-text">Ingrese la capitalización.</small>
        }
      </div>

      <!-- Estado -->
      <div class="form-field">
        <label>Estado</label>
        <select formControlName="estado">
          <option [ngValue]="true">Activo</option>
          <option [ngValue]="false">Inactivo</option>
        </select>
      </div>
    </div>

    <div class="actions">
      <button type="submit" [disabled]="loading || form.invalid">
        @if (loading) {
          Guardando...
        } @else {
          Registrar crédito
        }
      </button>
    </div>
  </form>
</div>
