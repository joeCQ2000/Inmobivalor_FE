<h2 class="text-center text-2xl font-bold mb-6 text-foreground dark:text-white">
  Simulación de Crédito - Método Francés
</h2>

<form
  [formGroup]="metodoFrancesForm"
  (ngSubmit)="simular()"
  class="w-full mx-auto px-4"
>
  <div
    class="bg-transparent text-white border border-primary-background/90 rounded-2xl shadow-xl overflow-hidden"
  >
    <!-- Header de la card -->
    <div class="bg-primary text-foreground px-4 py-2.5 text-xs font-semibold">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs uppercase tracking-wider text-gray-100">
            Simulador financiero
          </p>
          <h3 class="text-xl font-semibold text-white">
            Método Francés
          </h3>
        </div>
      </div>
    </div>

    <!-- Contenido -->
    <div class="text-primary p-6 space-y-6">
      <!-- Datos del crédito -->
      <fieldset class="border-0">
        <legend class="px-2 text-lg font-semibold text-foreground mb-4">
          Datos del crédito
        </legend>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-primary">
          <div>
            <label class="text-sm text-foreground"> Precio de venta </label>
            <input
              type="number"
              formControlName="precio_venta_activo"
              placeholder="Ej: 350000"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground">
              % cuota inicial (0 - 1)
            </label>
            <input
              type="number"
              step="0.01"
              formControlName="porcentaje_cuota_inicial"
              placeholder="Ej: 0.2"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground"> Años del crédito </label>
            <input
              type="number"
              formControlName="numero_anhos"
              placeholder="Ej: 10"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground">
              Frecuencia pago (cuotas/año)
            </label>
            <input
              type="number"
              formControlName="frecuencia_pago"
              placeholder="Ej: 4"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground"> Días por año </label>
            <input
              type="number"
              formControlName="numero_dias_por_anho"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground"> TEA </label>
            <input
              type="number"
              step="0.0001"
              formControlName="tea"
              placeholder="Ej: 0.11"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground"> Tipo de gracia </label>
            <select
              formControlName="tipo_gracia"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            >
              <option value="SIN">SIN</option>
              <option value="TOTAL">TOTAL</option>
              <option value="PARCIAL">PARCIAL</option>
            </select>
          </div>

          <div>
            <label class="text-sm text-foreground">
              Nº cuotas con gracia
            </label>
            <input
              type="number"
              formControlName="meses_gracia"
              placeholder="Ej: 4"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>
        </div>
      </fieldset>

      <!-- Costos iniciales -->
      <fieldset class="border-0">
        <legend class="px-2 text-lg font-semibold text-foreground mb-4">
          Costos iniciales
        </legend>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-primary">
          <div>
            <label class="text-sm text-foreground">
              Costes notariales
            </label>
            <input
              type="number"
              formControlName="costes_notariales"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground">
              Costes registrales
            </label>
            <input
              type="number"
              formControlName="costes_registrales"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground"> Tasación </label>
            <input
              type="number"
              formControlName="tasacion"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground">
              Comisión de estudio
            </label>
            <input
              type="number"
              formControlName="comision_estudio"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground">
              Comisión de activación
            </label>
            <input
              type="number"
              formControlName="comision_activacion"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>
        </div>
      </fieldset>

      <!-- Costos periódicos y seguros -->
      <fieldset class="border-0">
        <legend class="px-2 text-lg font-semibold text-foreground mb-4">
          Costos periódicos y seguros
        </legend>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-primary">
          <div>
            <label class="text-sm text-foreground">
              Comisión periódica
            </label>
            <input
              type="number"
              formControlName="comision_periodica"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground"> Portes </label>
            <input
              type="number"
              formControlName="portes"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground">
              Gastos administración
            </label>
            <input
              type="number"
              formControlName="gastos_administracion"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground">
              % seguro desgravamen (mensual)
            </label>
            <input
              type="number"
              step="0.00001"
              formControlName="porcentaje_seguro_desgravamen"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground">
              % seguro riesgo (anual)
            </label>
            <input
              type="number"
              step="0.0001"
              formControlName="porcentaje_seguro_riesgo"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>

          <div>
            <label class="text-sm text-foreground">
              Tasa de descuento (TEA)
            </label>
            <input
              type="number"
              step="0.0001"
              formControlName="tasa_descuento"
              class="w-full p-2 bg-white text-black border border-gray-300 rounded"
            />
          </div>
        </div>
      </fieldset>

      <!-- Botones -->
      <div class="flex justify-center gap-4 pt-5">
        <button
          type="button"
          (click)="limpiar()"
          class="bg-primary text-white px-8 py-2.5 rounded-md hover:bg-primary font-semibold border border-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition"
        >
          Limpiar
        </button>
        <button
          type="submit"
          [disabled]="cargando"
          class="bg-primary text-white px-8 py-2.5 rounded-md hover:bg-primary font-semibold border border-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition"
        >
          {{ cargando ? 'Simulando...' : 'Simular' }}
        </button>
      </div>

      <div *ngIf="error" class="text-red-400 text-center text-sm">
        {{ error }}
      </div>
    </div>
  </div>
</form>

<!-- RESULTADOS: solo se muestran DESPUÉS de simular -->
<div *ngIf="simulacion as s" class="w-full mx-auto px-4 mt-8 space-y-6">
  <!-- Resumen -->
  <div
    class="bg-transparent text-foreground border border-primary-background/90 rounded-2xl shadow-xl overflow-hidden"
  >
    <div class="bg-primary text-foreground px-4 py-2.5 text-xs font-semibold">
      <h3 class="text-xl font-semibold text-white">
        Resumen de la simulación
      </h3>
    </div>

    <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
      <div>
        <p>Saldo a financiar: {{ s.datos.saldo_a_financiar | number:'1.2-2' }}</p>
        <p>Monto del préstamo: {{ s.datos.monto_prestamo | number:'1.2-2' }}</p>
        <p>Total intereses: {{ s.datos.total_intereses | number:'1.2-2' }}</p>
        <p>
          Total seg. desgravamen:
          {{ s.datos.total_seguro_desgravamen | number:'1.2-2' }}
        </p>
        <p>
          Total seg. riesgo:
          {{ s.datos.total_seguro_riesgo | number:'1.2-2' }}
        </p>
      </div>
      <div>
        <p>VAN: {{ s.indicadores.van | number:'1.2-2' }}</p>
        <p>TIR (período): {{ s.indicadores.tir | number:'1.4-4' }}</p>
        <p>TCEA: {{ s.indicadores.tcea }} %</p>
        <p>TREA: {{ s.indicadores.trea }} %</p>
        <p>Fecha cálculo: {{ s.indicadores.fecha_calculo }}</p>
      </div>
    </div>
  </div>

  <!-- Cronograma -->
  <div
    class="bg-transparent text-white border border-primary-background/90 rounded-2xl shadow-xl overflow-hidden"
  >
    <div class="bg-primary text-foreground px-4 py-2.5 text-xs font-semibold">
      <h3 class="text-xl font-semibold text-white">
        Cronograma de pagos - Método Francés
      </h3>
    </div>

    <div class="p-6 overflow-x-auto">
      <div class="max-h-[480px] overflow-y-auto">
        <table class="min-w-full text-xs text-left">
          <thead class="border-b border-white/20 text-foreground">
            <tr>
              <th class="px-2 py-1">#</th>
              <th class="px-2 py-1">P.G.</th>
              <th class="px-2 py-1">Saldo inicial</th>
              <th class="px-2 py-1">Interés</th>
              <th class="px-2 py-1">Amortización</th>
              <th class="px-2 py-1">Cuota (inc. seg.)</th>
              
              <th class="px-2 py-1">Saldo final</th>
              <th class="px-2 py-1">Flujo</th>
            </tr>
          </thead>
          <tbody>
  <tr
    *ngFor="let c of cronogramaView; trackBy: trackCuota"
    class="border-b border-white/10 hover:bg-white/5 text-foreground "
  >
    <td class="px-2 py-1">{{ c.numero_cuota }}</td>
    <td class="px-2 py-1">{{ c.periodo_gracia }}</td>
    <td class="px-2 py-1">{{ c.saldo_inicial }}</td>
    <td class="px-2 py-1">{{ c.interes }}</td>
    <td class="px-2 py-1">{{ c.amortizacion }}</td>
    <td class="px-2 py-1">{{ c.cuota_inc_seg }}</td>

    <td class="px-2 py-1">{{ c.saldo_final }}</td>
    <td class="px-2 py-1">{{ c.flujo }}</td>
  </tr>
</tbody>

        </table>
      </div>
    </div>
  </div>
</div>
